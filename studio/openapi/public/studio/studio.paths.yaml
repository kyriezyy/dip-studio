paths:
  # ============ 项目管理接口 ============
  /projects:
    post:
      operationId: createProject
      summary: 创建项目
      description: |
        创建新的项目。

        **约束条件：**
        - 项目名称最多128字符
        - 项目名称必须唯一
        - 项目描述最多400字符
      tags:
        - Project
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/CreateProjectRequest'
      responses:
        "201":
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/Project'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "409":
          $ref: './studio.schemas.yaml#/components/errors/ConflictError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

    get:
      operationId: listProjects
      summary: 获取项目列表
      description: 获取所有项目列表，按最近编辑时间倒序排列。
      tags:
        - Project
      responses:
        "200":
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/ProjectList'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  /projects/{project_id}:
    get:
      operationId: getProject
      summary: 获取项目详情
      description: 根据项目 ID 获取项目详情。
      tags:
        - Project
      parameters:
        - in: path
          name: project_id
          description: 项目 ID
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/Project'
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

    put:
      operationId: updateProject
      summary: 更新项目
      description: |
        更新项目信息。

        **约束条件：**
        - 项目名称最多128字符
        - 项目名称必须唯一
        - 项目描述最多400字符
      tags:
        - Project
      parameters:
        - in: path
          name: project_id
          description: 项目 ID
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/UpdateProjectRequest'
      responses:
        "200":
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/Project'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "409":
          $ref: './studio.schemas.yaml#/components/errors/ConflictError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

    delete:
      operationId: deleteProject
      summary: 删除项目
      description: |
        删除项目。确认操作由前端完成。

        **约束条件：**
        - 项目存在处于开发模式的节点时无法删除
        - 项目存在节点时无法删除
      tags:
        - Project
      parameters:
        - in: path
          name: project_id
          description: 项目 ID
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "204":
          description: 删除成功
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  /projects/{project_id}/nodes/tree:
    get:
      operationId: getNodeTree
      summary: 获取节点树
      description: |
        获取项目的完整节点树。

        返回从根节点（应用节点）开始的树形结构，包含所有子节点。
        如果项目没有节点，返回 null。
      tags:
        - Node
      parameters:
        - in: path
          name: project_id
          description: 项目 ID
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: 获取成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/NodeTree'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  # ============ 节点管理接口 ============
  /nodes/application:
    post:
      operationId: createApplicationNode
      summary: 创建应用节点
      description: |
        创建应用节点（根节点）。

        **约束条件：**
        - 一个项目只能有一个应用节点
        - 应用节点没有父节点
      tags:
        - Node
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/CreateApplicationNodeRequest'
      responses:
        "201":
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/Node'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  /nodes/page:
    post:
      operationId: createPageNode
      summary: 创建页面节点
      description: |
        创建页面节点。

        **约束条件：**
        - 页面节点只能在应用节点下创建
        - 项目存在开发模式节点时无法创建
      tags:
        - Node
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/CreatePageNodeRequest'
      responses:
        "201":
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/Node'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  /nodes/function:
    post:
      operationId: createFunctionNode
      summary: 创建功能节点
      description: |
        创建功能节点。

        **约束条件：**
        - 功能节点只能在页面节点下创建
        - 功能节点不能有子节点
        - 项目存在开发模式节点时无法创建
        - 创建时自动创建关联的功能设计文档
      tags:
        - Node
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/CreateFunctionNodeRequest'
      responses:
        "201":
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/Node'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  /nodes/{node_id}:
    put:
      operationId: updateNode
      summary: 更新节点
      description: |
        更新节点信息。

        **约束条件：**
        - 节点处于开发模式时无法编辑
      tags:
        - Node
      parameters:
        - in: path
          name: node_id
          description: 节点 ID (UUID)
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/UpdateNodeRequest'
      responses:
        "200":
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/Node'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

    delete:
      operationId: deleteNode
      summary: 删除节点
      description: |
        删除节点。

        **约束条件：**
        - 节点存在子节点时无法删除
        - 项目存在开发模式节点时无法删除
        - 删除功能节点时会同时删除关联的文档和文档块
      tags:
        - Node
      parameters:
        - in: path
          name: node_id
          description: 节点 ID (UUID)
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: 删除成功
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  /nodes/move:
    put:
      operationId: moveNode
      summary: 移动节点
      description: |
        移动节点到新的父节点下。

        **约束条件：**
        - 必须遵循节点层级约束（application → page → function）
        - 不能将节点移动到其子节点下
        - 项目存在开发模式节点时无法移动
      tags:
        - Node
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/MoveNodeRequest'
      responses:
        "200":
          description: 移动成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/Node'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  # ============ 项目词典接口 ============
  /dictionary:
    post:
      operationId: createDictionaryEntry
      summary: 新增术语
      description: |
        新增项目词典术语。

        **约束条件：**
        - 同一项目中术语名称必须唯一
        - 术语名称最多255字符
      tags:
        - Dictionary
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/CreateDictionaryEntryRequest'
      responses:
        "201":
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/DictionaryEntry'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "409":
          $ref: './studio.schemas.yaml#/components/errors/ConflictError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

    get:
      operationId: listDictionaryEntries
      summary: 查询词典
      description: 查询项目的所有词典条目，按术语名称排序。
      tags:
        - Dictionary
      parameters:
        - in: query
          name: project_id
          description: 项目 ID
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/DictionaryEntryList'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  /dictionary/{id}:
    put:
      operationId: updateDictionaryEntry
      summary: 更新术语
      description: |
        更新词典术语。

        **约束条件：**
        - 同一项目中术语名称必须唯一
        - 术语名称最多255字符
      tags:
        - Dictionary
      parameters:
        - in: path
          name: id
          description: 条目 ID
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/UpdateDictionaryEntryRequest'
      responses:
        "200":
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/DictionaryEntry'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "409":
          $ref: './studio.schemas.yaml#/components/errors/ConflictError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

    delete:
      operationId: deleteDictionaryEntry
      summary: 删除术语
      description: 删除词典术语。
      tags:
        - Dictionary
      parameters:
        - in: path
          name: id
          description: 条目 ID
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "204":
          description: 删除成功
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  # ============ 功能设计文档接口（TipTap + fast-json-patch） ============
  # 创建功能节点时已自动初始化文档为空 {}，无需单独初始化接口
  /documents/{document_id}:
    get:
      operationId: getDocument
      summary: 查询文档
      description: |
        入参 document_id（创建功能节点时已生成并初始化为空 {}），返回完整文档 JSON（单对象 {}）。
      tags:
        - Document
      parameters:
        - in: path
          name: document_id
          description: 文档 ID
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: 查询成功，返回文档内容对象 {}
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/DocumentContentObject'
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

    put:
      operationId: putDocument
      summary: 文档增量更新
      description: |
        对文档内容 {} 进行增量更新（RFC 6902 JSON Patch），仅返回是否更新成功。
      tags:
        - Document
      parameters:
        - in: path
          name: document_id
          description: 文档 ID
          required: true
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './studio.schemas.yaml#/components/schemas/PatchDocumentBlocksRequest'
      responses:
        "200":
          description: 更新成功，仅返回是否成功
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/PatchDocumentResponse'
        "400":
          $ref: './studio.schemas.yaml#/components/errors/ParameterError'
        "404":
          $ref: './studio.schemas.yaml#/components/errors/NotFoundError'
        "500":
          $ref: './studio.schemas.yaml#/components/errors/InternalServerError'

  # ============ 健康检查接口 ============
  /health:
    get:
      operationId: healthCheck
      summary: 健康检查
      description: 检查服务健康状态。
      tags:
        - Health
      security: []
      responses:
        "200":
          description: 服务健康
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/HealthResponse'

  /ready:
    get:
      operationId: readyCheck
      summary: 就绪检查
      description: 检查服务是否就绪。
      tags:
        - Health
      security: []
      responses:
        "200":
          description: 服务就绪
          content:
            application/json:
              schema:
                $ref: './studio.schemas.yaml#/components/schemas/HealthResponse'
