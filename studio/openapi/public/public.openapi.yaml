openapi: 3.1.0

info:
  title: DIP Studio 项目管理接口
  description: |
    DIP Studio 项目管理模块接口文档。
    
    ## 功能模块
    
    ### 项目管理 (Project)
    - **创建项目**: POST /projects - 创建新的项目
    - **获取项目列表**: GET /projects - 获取所有项目列表
    - **获取项目详情**: GET /projects/{project_id} - 根据项目 ID 获取项目详情
    - **更新项目**: PUT /projects/{project_id} - 更新项目信息
    - **删除项目**: DELETE /projects/{project_id} - 删除项目（确认操作由前端完成）
    
    ### 节点管理 (Node)
    - **创建应用节点**: POST /nodes/application - 创建应用节点（根节点）
    - **创建页面节点**: POST /nodes/page - 创建页面节点
    - **创建功能节点**: POST /nodes/function - 创建功能节点
    - **获取节点树**: GET /projects/{project_id}/nodes/tree - 获取项目的完整节点树
    - **更新节点**: PUT /nodes/{node_id} - 更新节点信息
    - **移动节点**: PUT /nodes/move - 移动节点到新的父节点下
    - **删除节点**: DELETE /nodes/{node_id} - 删除节点
    
    ### 项目词典 (Dictionary)
    - **新增术语**: POST /dictionary - 新增项目词典术语
    - **查询词典**: GET /dictionary - 查询项目的所有词典条目
    - **更新术语**: PUT /dictionary/{id} - 更新词典术语
    - **删除术语**: DELETE /dictionary/{id} - 删除词典术语
    
    ### 功能设计文档 (Document，TipTap + fast-json-patch)
    - **查询文档**: GET /documents/{document_id} - 根据 document_id 获取完整文档 JSON（创建功能节点时已初始化为空 {}）
    - **文档增量更新**: PUT /documents/{document_id} - 对文档内容 {} 做 RFC 6902 JSON Patch 增量更新，仅返回是否更新成功
    
    ### 健康检查 (Health)
    - **健康检查**: GET /health - 检查服务健康状态
    - **就绪检查**: GET /ready - 检查服务是否就绪
  version: 1.0.0
  contact:
    name: DIP Studio Team

tags:
  - name: Project
    description: 项目管理接口
  - name: Node
    description: 节点管理接口
  - name: Dictionary
    description: 项目词典接口
  - name: Document
    description: 功能设计文档接口
  - name: Health
    description: 健康检查接口

security:
  - BearerAuth: []

servers:
  - url: /api/dip-studio/v1
    description: DIP Studio API 服务

paths:
  # ============ 项目管理 ============
  /projects:
    $ref: "./studio/studio.paths.yaml#/paths/~1projects"

  /projects/{project_id}:
    $ref: "./studio/studio.paths.yaml#/paths/~1projects~1{project_id}"

  /projects/{project_id}/nodes/tree:
    $ref: "./studio/studio.paths.yaml#/paths/~1projects~1{project_id}~1nodes~1tree"

  # ============ 节点管理 ============
  /nodes/application:
    $ref: "./studio/studio.paths.yaml#/paths/~1nodes~1application"

  /nodes/page:
    $ref: "./studio/studio.paths.yaml#/paths/~1nodes~1page"

  /nodes/function:
    $ref: "./studio/studio.paths.yaml#/paths/~1nodes~1function"

  /nodes/{node_id}:
    $ref: "./studio/studio.paths.yaml#/paths/~1nodes~1{node_id}"

  /nodes/move:
    $ref: "./studio/studio.paths.yaml#/paths/~1nodes~1move"

  # ============ 项目词典 ============
  /dictionary:
    $ref: "./studio/studio.paths.yaml#/paths/~1dictionary"

  /dictionary/{id}:
    $ref: "./studio/studio.paths.yaml#/paths/~1dictionary~1{id}"

  # ============ 功能设计文档（TipTap + fast-json-patch） ============
  /documents/{document_id}:
    $ref: "./studio/studio.paths.yaml#/paths/~1documents~1{document_id}"

  # ============ 健康检查 ============
  /health:
    $ref: "./studio/studio.paths.yaml#/paths/~1health"

  /ready:
    $ref: "./studio/studio.paths.yaml#/paths/~1ready"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: JWT Bearer Token 认证

  schemas:
    # 项目相关
    Project:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/Project"
    ProjectList:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/ProjectList"
    CreateProjectRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/CreateProjectRequest"
    UpdateProjectRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/UpdateProjectRequest"
    
    # 节点相关
    Node:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/Node"
    NodeTree:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/NodeTree"
    CreateApplicationNodeRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/CreateApplicationNodeRequest"
    CreatePageNodeRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/CreatePageNodeRequest"
    CreateFunctionNodeRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/CreateFunctionNodeRequest"
    UpdateNodeRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/UpdateNodeRequest"
    MoveNodeRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/MoveNodeRequest"
    
    # 词典相关
    DictionaryEntry:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/DictionaryEntry"
    DictionaryEntryList:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/DictionaryEntryList"
    CreateDictionaryEntryRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/CreateDictionaryEntryRequest"
    UpdateDictionaryEntryRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/UpdateDictionaryEntryRequest"
    
    # 文档相关
    DocumentContent:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/DocumentContent"
    FunctionDocument:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/FunctionDocument"
    DocumentBlock:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/DocumentBlock"
    JsonPatchOperation:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/JsonPatchOperation"
    PatchDocumentBlocksRequest:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/PatchDocumentBlocksRequest"
    DocumentContentObject:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/DocumentContentObject"
    PatchDocumentResponse:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/PatchDocumentResponse"
    
    # 健康检查
    HealthResponse:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/HealthResponse"
    
    # 错误响应
    ErrorResponse:
      $ref: "./studio/studio.schemas.yaml#/components/schemas/ErrorResponse"
